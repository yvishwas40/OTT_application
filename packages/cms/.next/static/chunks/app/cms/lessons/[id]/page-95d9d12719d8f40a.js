(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[61],{5560:function(e,s,a){Promise.resolve().then(a.bind(a,2502))},5555:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(4313).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},2502:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return C}});var t=a(7573),l=a(7653),i=a(1695),n=a(8146),r=a(9985),c=a(2226),d=a(6991),o=a(997),m=a(1269),u=a(3172);function x(e){let{lesson:s,onUpdate:a}=e,[i,n]=(0,l.useState)(!1),[r,x]=(0,l.useState)(""),[h,p]=(0,l.useState)(""),[g,b]=(0,l.useState)(""),[v,j]=(0,l.useState)(""),[y,N]=(0,l.useState)({language:"en",variant:"LANDSCAPE",url:""});(0,l.useEffect)(()=>{if(s){let e=s.contentLanguagePrimary||"en";b((s.contentUrlsByLanguage||{})[e]||""),j((s.subtitleUrlsByLanguage||{})[e]||"")}},[s]);let f=async()=>{n(!0),x(""),p("");try{let e=s.contentLanguagePrimary||"en",t={...s.contentUrlsByLanguage||{},[e]:g},l={...s.subtitleUrlsByLanguage||{},[e]:v},i=new Set(s.contentLanguagesAvailable||[]);g&&i.add(e);let n=new Set(s.subtitleLanguages||[]);v&&n.add(e),await c.h.patch("/lessons/".concat(s.id),{contentUrlsByLanguage:t,subtitleUrlsByLanguage:l,contentLanguagesAvailable:Array.from(i),subtitleLanguages:Array.from(n)}),p("Media updated successfully"),a()}catch(s){var e,t;console.error("Failed to update media:",s),x((null===(t=s.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||"Failed to update media")}finally{n(!1)}},w=async e=>{if(e.preventDefault(),y.url){n(!0),x("");try{await c.h.post("/assets/lessons",{lessonId:s.id,language:y.language,variant:y.variant,assetType:"thumbnail",url:y.url}),N(e=>({...e,url:""})),a()}catch(e){var t,l;console.error("Failed to add thumbnail:",e),x((null===(l=e.response)||void 0===l?void 0:null===(t=l.data)||void 0===t?void 0:t.message)||"Failed to add thumbnail")}finally{n(!1)}}},S=async e=>{if(confirm("Delete this thumbnail?")){n(!0);try{await c.h.delete("/assets/lessons/".concat(e)),a()}catch(e){var s,t;console.error("Failed to delete thumbnail:",e),x((null===(t=e.response)||void 0===t?void 0:null===(s=t.data)||void 0===s?void 0:s.message)||"Failed to delete thumbnail")}finally{n(!1)}}};if(!s)return null;let k=(s.assets||[]).filter(e=>"thumbnail"===e.assetType);return(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsxs)("div",{className:"card p-6",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-white mb-6",children:"Episode Media URLs"}),r&&(0,t.jsx)("div",{className:"mb-4 p-4 bg-red-900/30 border border-red-900/50 rounded-lg text-red-400 text-sm",children:r}),h&&(0,t.jsx)("div",{className:"mb-4 p-4 bg-green-900/30 border border-green-900/50 rounded-lg text-green-400 text-sm",children:h}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:["Video Content URL (",s.contentLanguagePrimary,")"]}),(0,t.jsx)("input",{type:"url",value:g,onChange:e=>b(e.target.value),className:"input-field w-full",placeholder:"https://example.com/video.mp4"}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Primary language video source (HLS/MP4)"})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:["Subtitle URL (",s.contentLanguagePrimary,")"]}),(0,t.jsx)("input",{type:"url",value:v,onChange:e=>j(e.target.value),className:"input-field w-full",placeholder:"https://example.com/captions.vtt"}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Primary language subtitles (VTT format)"})]}),(0,t.jsx)("div",{className:"pt-4",children:(0,t.jsxs)("button",{onClick:f,disabled:i,className:"btn-primary flex items-center gap-x-2 disabled:opacity-50",children:[(0,t.jsx)(d.Z,{className:"h-4 w-4"}),i?"Saving...":"Save Media"]})})]})]}),(0,t.jsxs)("div",{className:"card p-6",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-white mb-6",children:"Thumbnails"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8",children:[k.map(e=>(0,t.jsxs)("div",{className:"group relative border border-slate-700 rounded-lg overflow-hidden bg-slate-900",children:[(0,t.jsxs)("div",{className:"aspect-video relative",children:[(0,t.jsx)("img",{src:e.url,alt:"".concat(e.variant," ").concat(e.language),className:"w-full h-full object-cover"}),(0,t.jsx)("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:(0,t.jsx)("button",{onClick:()=>S(e.id),className:"p-2 bg-red-600 rounded-full text-white hover:bg-red-700 transition-colors",title:"Delete Thumbnail",children:(0,t.jsx)(o.Z,{className:"h-4 w-4"})})})]}),(0,t.jsxs)("div",{className:"p-3 bg-slate-800 border-t border-slate-700",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center text-xs",children:[(0,t.jsx)("span",{className:"font-medium text-gray-300",children:e.variant}),(0,t.jsx)("span",{className:"text-gray-500 uppercase",children:e.language})]}),(0,t.jsx)("div",{className:"mt-1 text-xs text-gray-600 truncate",title:e.url,children:e.url})]})]},e.id)),0===k.length&&(0,t.jsxs)("div",{className:"col-span-full py-8 text-center text-gray-500 border-2 border-dashed border-slate-700 rounded-lg",children:[(0,t.jsx)(m.Z,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),(0,t.jsx)("p",{children:"No thumbnails uploaded"})]})]}),(0,t.jsxs)("div",{className:"border-t border-slate-700 pt-6",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-gray-300 mb-4",children:"Add New Thumbnail"}),(0,t.jsxs)("form",{onSubmit:w,className:"flex gap-4 items-end bg-slate-800/50 p-4 rounded-lg border border-slate-700",children:[(0,t.jsxs)("div",{className:"w-32",children:[(0,t.jsx)("label",{className:"block text-xs text-gray-400 mb-1",children:"Language"}),(0,t.jsxs)("select",{value:y.language,onChange:e=>N({...y,language:e.target.value}),className:"input-field w-full py-1.5 text-sm",children:[(0,t.jsx)("option",{value:"en",children:"English"}),(0,t.jsx)("option",{value:"es",children:"Spanish"}),(0,t.jsx)("option",{value:"fr",children:"French"}),(0,t.jsx)("option",{value:"te",children:"Telugu"}),(0,t.jsx)("option",{value:"hi",children:"Hindi"})]})]}),(0,t.jsxs)("div",{className:"w-32",children:[(0,t.jsx)("label",{className:"block text-xs text-gray-400 mb-1",children:"Variant"}),(0,t.jsxs)("select",{value:y.variant,onChange:e=>N({...y,variant:e.target.value}),className:"input-field w-full py-1.5 text-sm",children:[(0,t.jsx)("option",{value:"LANDSCAPE",children:"Landscape"}),(0,t.jsx)("option",{value:"PORTRAIT",children:"Portrait"}),(0,t.jsx)("option",{value:"SQUARE",children:"Square"})]})]}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("label",{className:"block text-xs text-gray-400 mb-1",children:"Image URL"}),(0,t.jsx)("input",{type:"url",value:y.url,onChange:e=>N({...y,url:e.target.value}),className:"input-field w-full py-1.5 text-sm",placeholder:"https://...",required:!0})]}),(0,t.jsxs)("button",{type:"submit",disabled:i||!y.url,className:"btn-primary py-1.5 px-4 flex items-center gap-x-2 disabled:opacity-50",children:[(0,t.jsx)(u.Z,{className:"h-4 w-4"}),"Add"]})]})]})]})]})}var h=a(4629),p=a(1883),g=a(5555),b=a(269),v=a(4915),j=a(4313);let y=(0,j.Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);var N=a(3727);let f=(0,j.Z)("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);var w=a(1673),S=a(5431);function k(){var e,s,a;let o=(0,i.useParams)(),{user:m}=(0,h.a)(),u=o.id,[j,k]=(0,l.useState)(null),[C,L]=(0,l.useState)(!0),[D,E]=(0,l.useState)("details"),[P,A]=(0,l.useState)(!1),[T,F]=(0,l.useState)({}),[M,U]=(0,l.useState)(""),[Z,I]=(0,l.useState)("");(0,l.useEffect)(()=>{R()},[u]);let R=async()=>{try{let e=await c.h.get("/lessons/".concat(u));k(e.data),F({title:e.data.title,contentType:e.data.contentType,durationMs:e.data.durationMs,isPaid:e.data.isPaid,contentLanguagePrimary:e.data.contentLanguagePrimary})}catch(e){console.error("Failed to fetch lesson:",e)}finally{L(!1)}},B=async()=>{try{await c.h.patch("/lessons/".concat(u),T),A(!1),await R()}catch(a){var e,s;alert((null===(s=a.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.message)||"Failed to update lesson")}},H=async()=>{if(confirm("Drop this episode now?"))try{await c.h.post("/lessons/".concat(u,"/publish")),await R(),alert("Episode dropped successfully!")}catch(a){var e,s;alert((null===(s=a.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.message)||"Failed to drop episode")}},V=async()=>{if(!M||!Z){alert("Please select both date and time");return}let e=new Date("".concat(M,"T").concat(Z));if(e<=new Date){alert("Schedule time must be in the future");return}try{await c.h.post("/lessons/".concat(u,"/schedule"),{publishAt:e.toISOString()}),await R(),alert("Episode scheduled for drop successfully!"),U(""),I("");let s=document.getElementById("schedule-modal");s&&s.close()}catch(e){var s,a;alert((null===(a=e.response)||void 0===a?void 0:null===(s=a.data)||void 0===s?void 0:s.message)||"Failed to schedule episode drop")}},O=async()=>{if(confirm("Archive this episode?"))try{await c.h.post("/lessons/".concat(u,"/archive")),await R(),alert("Episode archived successfully!")}catch(a){var e,s;alert((null===(s=a.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.message)||"Failed to archive episode")}};if(C)return(0,t.jsx)(r.o,{children:(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-yellow-500 mx-auto"}),(0,t.jsx)("p",{className:"text-gray-400 mt-4",children:"Loading episode..."})]})});if(!j)return(0,t.jsx)(r.o,{children:(0,t.jsxs)("div",{className:"card p-12 text-center",children:[(0,t.jsx)("h3",{className:"text-lg font-medium text-white mb-2",children:"Episode not found"}),(0,t.jsx)(n.default,{href:"/cms/lessons",className:"text-yellow-500 hover:text-yellow-400 hover:underline",children:"Back to Episodes"})]})});let _=(null==m?void 0:m.role)==="ADMIN"||(null==m?void 0:m.role)==="EDITOR";return(0,t.jsx)(r.o,{children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(n.default,{href:"/cms/lessons",className:"p-2 hover:bg-slate-800 rounded transition-colors text-gray-400 hover:text-white",children:(0,t.jsx)(p.Z,{className:"h-5 w-5"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-white",children:j.title}),(0,t.jsxs)("div",{className:"flex items-center gap-4 mt-2",children:[(0,t.jsx)("span",{className:"px-3 py-1 rounded text-sm font-medium ".concat((e=>{switch(e){case"PUBLISHED":return"bg-success-900/30 text-success-400 border border-success-900/50";case"SCHEDULED":return"bg-warning-900/30 text-warning-400 border border-warning-900/50";case"DRAFT":default:return"bg-slate-800 text-gray-400 border border-slate-700";case"ARCHIVED":return"bg-red-900/30 text-red-400 border border-red-900/50"}})(j.status)),children:"PUBLISHED"===j.status?"Dropped":"SCHEDULED"===j.status?"Scheduled Drop":j.status}),j.publishedAt&&(0,t.jsxs)("div",{className:"flex items-center text-sm text-gray-400",children:[(0,t.jsx)(g.Z,{className:"h-4 w-4 mr-1"}),"Published ",new Date(j.publishedAt).toLocaleDateString()]})]})]}),_&&(0,t.jsxs)("div",{className:"flex gap-2",children:["details"===D&&(0,t.jsx)(t.Fragment,{children:P?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("button",{onClick:B,className:"btn-primary flex items-center gap-x-2",children:[(0,t.jsx)(d.Z,{className:"h-4 w-4"}),"Save"]}),(0,t.jsxs)("button",{onClick:()=>{A(!1),R()},className:"btn-secondary flex items-center gap-x-2",children:[(0,t.jsx)(b.Z,{className:"h-4 w-4"}),"Cancel"]})]}):(0,t.jsxs)("button",{onClick:()=>A(!0),className:"btn-primary flex items-center gap-x-2",children:[(0,t.jsx)(v.Z,{className:"h-4 w-4"}),"Edit Details"]})}),!P&&(0,t.jsxs)(t.Fragment,{children:["DRAFT"===j.status&&(0,t.jsxs)("button",{onClick:H,className:"bg-success-600 hover:bg-success-500 text-white font-medium py-2 px-4 rounded-lg transition-colors flex items-center gap-x-2",children:[(0,t.jsx)(y,{className:"h-4 w-4"}),"Drop"]}),"DRAFT"===j.status&&(0,t.jsxs)("button",{onClick:()=>{let e=document.getElementById("schedule-modal");e&&e.showModal()},className:"bg-warning-600 hover:bg-warning-500 text-white font-medium py-2 px-4 rounded-lg transition-colors flex items-center gap-x-2",children:[(0,t.jsx)(N.Z,{className:"h-4 w-4"}),"Schedule"]}),"ARCHIVED"!==j.status&&(0,t.jsxs)("button",{onClick:O,className:"btn-secondary flex items-center gap-x-2",children:[(0,t.jsx)(f,{className:"h-4 w-4"}),"Archive"]})]})]})]}),(0,t.jsx)("div",{className:"border-b border-slate-700",children:(0,t.jsxs)("div",{className:"flex gap-6",children:[(0,t.jsxs)("button",{onClick:()=>E("details"),className:"flex items-center gap-2 pb-3 border-b-2 transition-colors ".concat("details"===D?"border-yellow-500 text-yellow-500":"border-transparent text-gray-400 hover:text-white"),children:[(0,t.jsx)(w.Z,{className:"h-4 w-4"}),"Details"]}),(0,t.jsxs)("button",{onClick:()=>E("media"),className:"flex items-center gap-2 pb-3 border-b-2 transition-colors ".concat("media"===D?"border-yellow-500 text-yellow-500":"border-transparent text-gray-400 hover:text-white"),children:[(0,t.jsx)(S.Z,{className:"h-4 w-4"}),"Media"]})]})}),"details"===D&&(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,t.jsx)("div",{className:"lg:col-span-2 space-y-6",children:(0,t.jsxs)("div",{className:"card p-6",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Episode Details"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Title"}),P?(0,t.jsx)("input",{type:"text",value:T.title,onChange:e=>F({...T,title:e.target.value}),className:"input-field"}):(0,t.jsx)("p",{className:"text-gray-100",children:j.title})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Content Type"}),P?(0,t.jsxs)("select",{value:T.contentType,onChange:e=>F({...T,contentType:e.target.value}),className:"input-field",children:[(0,t.jsx)("option",{value:"VIDEO",children:"Video"}),(0,t.jsx)("option",{value:"TEXT",children:"Text"})]}):(0,t.jsx)("p",{className:"text-gray-100",children:j.contentType})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Duration (minutes)"}),P?(0,t.jsx)("input",{type:"number",value:T.durationMs?Math.floor(T.durationMs/6e4):0,onChange:e=>F({...T,durationMs:6e4*parseInt(e.target.value)}),className:"input-field"}):(0,t.jsx)("p",{className:"text-gray-100",children:j.durationMs?"".concat(Math.floor(j.durationMs/6e4)," min"):"N/A"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Access"}),P?(0,t.jsxs)("label",{className:"flex items-center",children:[(0,t.jsx)("input",{type:"checkbox",checked:T.isPaid,onChange:e=>F({...T,isPaid:e.target.checked}),className:"mr-2 rounded border-gray-600 bg-slate-800 text-yellow-500 focus:ring-yellow-500"}),(0,t.jsx)("span",{className:"text-sm text-gray-300",children:"Premium Episode (Requires Subscription)"})]}):(0,t.jsx)("p",{className:"text-gray-100",children:j.isPaid?"Premium":"Free"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Primary Language"}),P?(0,t.jsxs)("select",{value:T.contentLanguagePrimary,onChange:e=>F({...T,contentLanguagePrimary:e.target.value}),className:"input-field",children:[(0,t.jsx)("option",{value:"en",children:"English"}),(0,t.jsx)("option",{value:"es",children:"Spanish"}),(0,t.jsx)("option",{value:"fr",children:"French"}),(0,t.jsx)("option",{value:"te",children:"Telugu"}),(0,t.jsx)("option",{value:"hi",children:"Hindi"})]}):(0,t.jsx)("p",{className:"text-gray-100",children:j.contentLanguagePrimary})]})]})]})}),(0,t.jsx)("div",{className:"space-y-6",children:(0,t.jsxs)("div",{className:"card p-6",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Episode Info"}),(0,t.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-500",children:"Series"}),(0,t.jsx)("p",{className:"text-gray-200 font-medium",children:null===(s=j.term)||void 0===s?void 0:null===(e=s.program)||void 0===e?void 0:e.title})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-500",children:"Season"}),(0,t.jsxs)("p",{className:"text-gray-200 font-medium",children:["Season ",null===(a=j.term)||void 0===a?void 0:a.termNumber]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-500",children:"Episode Number"}),(0,t.jsx)("p",{className:"text-gray-200 font-medium",children:j.lessonNumber})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-500",children:"Created"}),(0,t.jsx)("span",{className:"text-gray-400",children:new Date(j.createdAt).toLocaleDateString()})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-500",children:"Last Updated"}),(0,t.jsx)("span",{className:"text-gray-400",children:new Date(j.updatedAt).toLocaleDateString()})]})]})]})})]}),"media"===D&&(0,t.jsx)(x,{lesson:j,onUpdate:R}),(0,t.jsxs)("dialog",{id:"schedule-modal",className:"modal",children:[(0,t.jsxs)("div",{className:"modal-box bg-slate-900 border border-slate-700 text-gray-100",children:[(0,t.jsx)("h3",{className:"font-bold text-lg mb-4 text-white",children:"Schedule Drop"}),(0,t.jsx)("p",{className:"text-gray-400 mb-4 text-sm",children:"Select when this episode should be dropped."}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Date"}),(0,t.jsx)("input",{type:"date",value:M,onChange:e=>U(e.target.value),className:"input-field w-full"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Time"}),(0,t.jsx)("input",{type:"time",value:Z,onChange:e=>I(e.target.value),className:"input-field w-full"})]})]}),(0,t.jsx)("div",{className:"modal-action",children:(0,t.jsxs)("form",{method:"dialog",className:"flex gap-2",children:[(0,t.jsx)("button",{type:"button",onClick:V,className:"btn-primary",children:"Schedule"}),(0,t.jsx)("button",{type:"submit",className:"btn-secondary",children:"Cancel"})]})})]}),(0,t.jsx)("form",{method:"dialog",className:"modal-backdrop",children:(0,t.jsx)("button",{children:"close"})})]})]})})}function C(){return(0,t.jsx)(k,{})}}},function(e){e.O(0,[908,280,997,293,427,744],function(){return e(e.s=5560)}),_N_E=e.O()}]);